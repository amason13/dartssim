import numpy as np

class Player:
    
    def __init__(self, name="player_name", treble_pct=0.4, single_pct=0.5, big_miss_pct=0.05,small_miss_pct=0.05,bull_pct=0.35,outer_pct=0.6,double_pct=0.4):
    
        self.treble_pct = treble_pct
        self.single_pct = single_pct
        self.big_miss_pct = big_miss_pct
        self.small_miss_pct = small_miss_pct
        self.bull_pct = bull_pct
        self.outer_pct = outer_pct
        self.double_pct = double_pct
        self.name = name
        
        self.score = 501
        self.op_score = 501
        self.t=self.treble_pct
        self.s=self.single_pct+self.treble_pct
        self.bm = self.treble_pct+self.single_pct+self.big_miss_pct
        self.sm = self.treble_pct+self.single_pct+self.big_miss_pct+self.small_miss_pct
        self.d = self.double_pct
        
        self.neighbours = {
        20:[1,5],
        1: [20,18],
        18:[1,4],
        4: [18,13],
        13:[4,6],
        6: [13,10],
        10:[6,15],
        15:[10,2],
        2: [15,17],
        17:[3,2],
        3: [17,19],
        19:[3,7],
        7: [16,19],
        16:[7,8],
        8: [11,16],
        11:[8,14],
        14:[11,9],
        9: [14,12],
        12:[9,5],
        5: [12,20],
        25:[50,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],
        50:[25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
        } 
        
         
        self.THREE = {
        2:('double',1),
        3:('single',1),
        4:('double',2),
        5:('single',1),
        6:('double',3),
        7:('single',1),
        8:('double',4),
        9:('single',1),
        10:('double',5),
        11:('single',3),
        12:('double',6),
        13:('single',5),
        14:('double',7),
        15:('single',7),
        16:('double',8),
        17:('single',1),
        18:('double',9),
        19:('single',3),
        20:('double',10),
        21:('single',5),
        22:('double',11),
        23:('single',7),
        24:('double',12),
        25:('single',9),
        26:('double',13),
        27:('single',11),
        28:('double',14),
        29:('single',13),
        30:('double',15),
        31:('single',15),
        32:('double',16),
        33:('single',1),
        34:('double',17),
        35:('single',3),
        36:('double',18),
        37:('single',5),
        38:('double',19),
        39:('single',7),
        40:('double',20),
        41:('single',9),
        42:('single',10),
        43:('single',11),
        44:('single',12),
        45:('single',13),
        46:('single',14),
        47:('single',15),
        48:('single',16),
        49:('single',17),
        50:('single',18),
        51:('single',19),
        52:('single',20),
        53:('single',13),
        54:('single',14),
        55:('single',15),
        56:('single',16),
        57:('single',17),
        58:('single',18),
        59:('single',19),
        60:('single',20),
        61:('treble',15),
        62:('treble',10),
        63:('treble',13),
        64:('treble',16),
        65:('treble',19),
        66:('treble',10),
        67:('treble',17),
        68:('treble',20),
        69:('treble',19), 
        70:('treble',18),
        71:('treble',13),
        72:('treble',16),
        73:('treble',19),
        74:('treble',14),
        75:('treble',13),
        76:('treble',20),
        77:('treble',19),
        78:('treble',18),
        79:('treble',19),
        80:('treble',20),
        81:('treble',19), 
        82:('treble',14), 
        83:('treble',17), 
        84:('treble',20),
        85:('treble',15),
        86:('treble',18),
        87:('treble',17),
        88:('treble',20),
        89:('treble',19),
        90:('treble',20),
        91:('treble',17),
        92:('treble',20),
        93:('treble',19),
        94:('treble',18),
        95:('treble',19), 
        96:('treble',20),
        97:('treble',19),
        98:('treble',20),
        99:('treble',19),
        100:('treble',20),
        101:('treble',20),
        102:('treble',20),
        103:('treble',20),
        104:('treble',18),
        105:('treble',19),
        106:('treble',20),
        107:('treble',19),
        108:('treble',20),
        109:('treble',19),
        110:('treble',20),
        111:('treble',20),
        112:('treble',20),
        113:('treble',20),
        114:('treble',20),
        115:('treble',20),
        116:('treble',20),
        117:('treble',20),
        118:('treble',20),
        119:('treble',19),
        120:('treble',20),
        121:('treble',17),
        122:('treble',18),
        123:('treble',19),
        124:('treble',20),
        125:('outer',25),
        126:('treble',19),
        127:('treble',20),
        128:('treble',18),
        129:('treble',19),
        130:('treble',20),
        131:('treble',20),
        132:('treble',20),
        133:('treble',20),
        134:('treble',20),
        135:('treble',20),
        136:('treble',20),
        137:('treble',19),
        138:('treble',20),
        139:('treble',19),
        140:('treble',20),
        141:('treble',20),
        142:('treble',20),
        143:('treble',20),
        144:('treble',20),
        145:('treble',20),
        146:('treble',20),
        147:('treble',20),
        148:('treble',20),
        149:('treble',20),
        150:('treble',20),
        151:('treble',20),
        152:('treble',20),
        153:('treble',20),
        154:('treble',20),
        155:('treble',20),
        156:('treble',20),
        157:('treble',20),
        158:('treble',20),
        159:('treble',20),###
        160:('treble',20),
        161:('treble',20),
        162:('treble',19),###
        163:('treble',20),###
        164:('treble',20),
        165:('treble',19),###
        166:('treble',19),###
        167:('treble',20),
        168:('treble',19),###
        169:('treble',20),###
        170:('treble',20),
        171:('treble',20),
        172:('treble',20),
        173:('treble',19),
        174:('treble',19),
        175:('treble',20),
        176:('treble',19),
        177:('big_treble',1),
        178:('treble',19),
        179:('treble',20),
        180:('treble',20),
        181:('treble',20),
        182:('treble',20),
        183:('treble',19),
        184:('treble',20),
        185:('treble',20),
        186:('treble',19),
        187:('treble',19),
        188:('treble',20),
        189:('treble',20),
        190:('treble',20),
        191:('treble',19),
        192:('treble',20),
        193:('treble',20),
        194:('treble',19),
        195:('treble',19),
        196:('treble',20),
        197:('treble',20),
        198:('treble',20),
        199:('treble',20),
        200:('treble',20),
        201:('treble',20),
        202:('treble',20),
        203:('treble',19),
        204:('treble',20),
        205:('treble',20),
        206:('treble',20),
        207:('treble',19),
        208:('treble',20),
        209:('treble',20),
        210:('treble',20),
        211:('treble',19),
        212:('treble',20),
        213:('treble',20), 
        214:('treble',20),
        215:('treble',20),
        216:('treble',20),
        217:('treble',20),
        218:('treble',20),
        219:('treble',20),
        220:('treble',20),
        221:('treble',20),
        222:('treble',20),
        223:('treble',20),
        224:('treble',20),
        225:('treble',20),
        226:('treble',20),
        227:('treble',20),
        228:('treble',20),
        229:('treble',20),
        230:('treble',20),
        231:('treble',20),
        232:('treble',20),
        233:('treble',20),
        234:('treble',20),
        235:('treble',20),
        236:('treble',20),
        237:('treble',20),
        238:('treble',20),
        239:('treble',20),
        240:('treble',20),
        241:('treble',20),
        242:('treble',20),
        243:('treble',19),
        244:('treble',20),
        245:('treble',20),
        246:('treble',20),
        247:('treble',19),
        248:('treble',20),
        249:('treble',20),
        250:('treble',20),
        251:('treble',19),
        252:('treble',20),
        253:('treble',20),
        254:('treble',20),
        255:('treble',20),
        256:('treble',20),
        257:('treble',20),
        258:('treble',20),
        259:('treble',19),
        260:('treble',20),
        261:('treble',20),
        262:('treble',19),
        263:('treble',20),
        264:('treble',20),
        265:('treble',19)
        }

        self.TWO = {
        2:('double',1),
        3:('single',1),
        4:('double',2),
        5:('single',1),
        6:('double',3),
        7:('single',1),
        8:('double',4),
        9:('single',1),
        10:('double',5),
        11:('single',3),
        12:('double',6),
        13:('single',5),
        14:('double',7),
        15:('single',7),
        16:('double',8),
        17:('single',1),
        18:('double',9),
        19:('single',3),
        20:('double',10),
        21:('single',5),
        22:('double',11),
        23:('single',7),
        24:('double',12),
        25:('single',9),
        26:('double',13),
        27:('single',11),
        28:('double',14),
        29:('single',13),
        30:('double',15),
        31:('single',15),
        32:('double',16),
        33:('single',1),
        34:('double',17),
        35:('single',3),
        36:('double',18),
        37:('single',5),
        38:('double',19),
        39:('single',7),
        40:('double',20),
        41:('single',9),
        42:('single',10),
        43:('single',11),
        44:('single',12),
        45:('single',13),
        46:('single',14),
        47:('single',15),
        48:('single',16),
        49:('single',17),
        50:('single',18),
        51:('single',19),
        52:('single',20),
        53:('single',13),
        54:('single',14),
        55:('single',15),
        56:('single',16),
        57:('single',17),
        58:('single',18),
        59:('single',19),
        60:('single',20),
        61:('outer',25),
        62:('treble',12),
        63:('treble',13),
        64:('treble',14),
        65:('treble',15),
        66:('treble',16),
        67:('treble',17),
        68:('treble',18),
        69:('treble',19), 
        70:('treble',20),
        71:('treble',13),
        72:('treble',16),
        73:('treble',19),
        74:('treble',14),
        75:('treble',17),
        76:('treble',20),
        77:('treble',19),
        78:('treble',18),
        79:('treble',19),
        80:('treble',20),
        81:('treble',19), 
        82:('bull',50),
        83:('treble',17), 
        84:('treble',20),
        85:('treble',15),
        86:('treble',18),
        87:('treble',17),
        88:('treble',20),
        89:('treble',19),
        90:('treble',20),
        91:('treble',17),
        92:('treble',20),
        93:('treble',19),
        94:('treble',18),
        95:('treble',19), 
        96:('treble',20),
        97:('treble',19),
        98:('treble',20),
        99:('treble',19),
        100:('treble',20),
        101:('treble',20),
        102:('treble',20),
        103:('treble',20),
        104:('treble',18),
        105:('treble',19),
        106:('treble',20),
        107:('treble',19),
        108:('treble',20),
        109:('treble',19),
        110:('treble',20),
        111:('treble',20),
        112:('treble',20),
        113:('treble',20),
        114:('treble',20),
        115:('treble',20),
        116:('treble',20),
        117:('treble',20),
        118:('treble',20),
        119:('treble',19),
        120:('treble',20),
        121:('treble',17),
        122:('treble',18),
        123:('treble',19),
        124:('treble',20),
        125:('outer',25),
        126:('treble',19),
        127:('treble',20),
        128:('treble',18),
        129:('treble',19),
        130:('treble',20),
        131:('treble',20),
        132:('treble',20),
        133:('treble',20),
        134:('treble',20),
        135:('treble',20),
        136:('treble',20),
        137:('treble',19),
        138:('treble',20),
        139:('treble',19),
        140:('treble',20),
        141:('treble',20),
        142:('treble',20),
        143:('treble',20),
        144:('treble',20),
        145:('treble',20),
        146:('treble',20),
        147:('treble',20),
        148:('treble',20),
        149:('treble',20),
        150:('treble',20),
        151:('treble',20),
        152:('treble',20),
        153:('treble',20),
        154:('treble',20),
        155:('treble',20),
        156:('treble',20),
        157:('treble',20),
        158:('treble',20),
        159:('treble',19),
        160:('treble',20),
        161:('treble',20),
        162:('treble',20),
        163:('treble',20),
        164:('treble',20),
        165:('treble',20),
        166:('treble',20),
        167:('treble',20),
        168:('treble',20),
        169:('treble',20),
        170:('treble',20),
        171:('treble',20),
        172:('treble',20),
        173:('treble',19),
        174:('treble',19),
        175:('treble',20),
        176:('treble',19),
        177:('big_treble',1),
        178:('treble',19),
        179:('treble',20),
        180:('treble',20),
        181:('treble',20),
        182:('treble',20),
        183:('treble',19),
        184:('treble',20),
        185:('treble',20),
        186:('treble',19),
        187:('treble',19),
        188:('treble',20),
        189:('treble',20),
        190:('treble',20),
        191:('treble',19),
        192:('treble',20),
        193:('treble',20),
        194:('treble',19),
        195:('treble',19),
        196:('treble',20),
        197:('treble',20),
        198:('treble',20),
        199:('treble',20),
        200:('treble',20),
        201:('treble',20),
        202:('treble',20),
        203:('treble',19),
        204:('treble',20),
        205:('treble',20),
        206:('treble',20),
        207:('treble',19),
        208:('treble',20),
        209:('treble',20),
        210:('treble',20),
        211:('treble',19),
        212:('treble',20),
        213:('treble',20), 
        214:('treble',20),
        215:('treble',20),
        216:('treble',20),
        217:('treble',20),
        218:('treble',20),
        219:('treble',20),
        220:('treble',20),
        221:('treble',20),
        222:('treble',20),
        223:('treble',20),
        224:('treble',20),
        225:('treble',20),
        226:('treble',20),
        227:('treble',20),
        228:('treble',20),
        229:('treble',20),
        230:('treble',20),
        231:('treble',20),
        232:('treble',20),
        233:('treble',20),
        234:('treble',20),
        235:('treble',20),
        236:('treble',20),
        237:('treble',20),
        238:('treble',20),
        239:('treble',20),
        240:('treble',20),
        241:('treble',20),
        242:('treble',20),
        243:('treble',19),
        244:('treble',20),
        245:('treble',20),
        246:('treble',20),
        247:('treble',19),
        248:('treble',20),
        249:('treble',20),
        250:('treble',20),
        251:('treble',19),
        252:('treble',20),
        253:('treble',20),
        254:('treble',20),
        255:('treble',20),
        256:('treble',20),
        257:('treble',20),
        258:('treble',20),
        259:('treble',19),
        260:('treble',20),
        261:('treble',20),
        262:('treble',19),
        263:('treble',20),
        264:('treble',20),
        265:('treble',19)
        }


        self.ONE = {
        2:('double',1),
        3:('single',1),
        4:('double',2),
        5:('single',1),
        6:('double',3),
        7:('single',1),
        8:('double',4),
        9:('single',1),
        10:('double',5),
        11:('single',3),
        12:('double',6),
        13:('single',5),
        14:('double',7),
        15:('single',7),
        16:('double',8),
        17:('single',1),
        18:('double',9),
        19:('single',3),
        20:('double',10),
        21:('single',5),
        22:('double',11),
        23:('single',7),
        24:('double',12),
        25:('single',9),
        26:('double',13),
        27:('single',11),
        28:('double',14),
        29:('single',13),
        30:('double',15),
        31:('single',15),
        32:('double',16),
        33:('single',1),
        34:('double',17),
        35:('single',3),
        36:('double',18),
        37:('single',5),
        38:('double',19),
        39:('single',7),
        40:('double',20),
        41:('single',9),
        42:('single',10),
        43:('single',11),
        44:('single',12),
        45:('single',13),
        46:('single',14),
        47:('single',15),
        48:('single',16),
        49:('single',17),
        50:('bull',50),
        51:('single',19),
        52:('single',20),
        53:('single',13),
        54:('single',14),
        55:('single',15),
        56:('single',16),
        57:('single',17),
        58:('single',18),
        59:('single',19),
        60:('single',20),
        61:('treble',15),
        62:('treble',10),
        63:('treble',13),
        64:('treble',16),
        65:('treble',11),
        66:('treble',10),
        67:('treble',17),
        68:('treble',12),
        69:('treble',11), 
        70:('treble',10),
        71:('treble',13),
        72:('treble',16),
        73:('treble',19),
        74:('treble',14),
        75:('treble',17),
        76:('treble',20),
        77:('treble',19),
        78:('treble',18),
        79:('treble',19),
        80:('treble',20),
        81:('treble',19), 
        82:('bull',0),
        83:('treble',17), 
        84:('treble',20),
        85:('treble',15),
        86:('treble',18),
        87:('treble',17),
        88:('treble',20),
        89:('treble',19),
        90:('treble',20),
        91:('treble',17),
        92:('treble',20),
        93:('treble',19),
        94:('treble',18),
        95:('treble',19), 
        96:('treble',20),
        97:('treble',19),
        98:('treble',20),
        99:('treble',19),
        100:('treble',20),
        101:('treble',20),
        102:('treble',20),
        103:('treble',20),
        104:('treble',18),
        105:('treble',19),
        106:('treble',20),
        107:('treble',19),
        108:('treble',20),
        109:('treble',19),
        110:('treble',20),
        111:('treble',20),
        112:('treble',20),
        113:('treble',20),
        114:('treble',20),
        115:('treble',20),
        116:('treble',20),
        117:('treble',20),
        118:('treble',20),
        119:('treble',19),
        120:('treble',20),
        121:('treble',17),
        122:('treble',18),
        123:('treble',19),
        124:('treble',20),
        125:('treble',20), 
        126:('treble',19),
        127:('treble',20),
        128:('treble',18),
        129:('treble',19),
        130:('treble',20),
        131:('treble',20),
        132:('treble',20),
        133:('treble',20),
        134:('treble',20),
        135:('treble',20),
        136:('treble',20),
        137:('treble',19),
        138:('treble',20),
        139:('treble',19),
        140:('treble',20),
        141:('treble',20),
        142:('treble',20),
        143:('treble',20),
        144:('treble',20),
        145:('treble',20),
        146:('treble',20),
        147:('treble',20),
        148:('treble',20),
        149:('treble',20),
        150:('treble',20),
        151:('treble',20),
        152:('treble',20),
        153:('treble',20),
        154:('treble',20),
        155:('treble',20),
        156:('treble',20),
        157:('treble',20),
        158:('treble',20),
        159:('treble',19),
        160:('treble',20),
        161:('treble',20),
        162:('treble',20),
        163:('treble',20),
        164:('treble',20),
        165:('treble',20),
        166:('treble',20),
        167:('treble',20),
        168:('treble',20),
        169:('treble',20),
        170:('treble',20),
        171:('treble',20),
        172:('treble',20),
        173:('treble',19),
        174:('treble',19),
        175:('treble',20),
        176:('treble',19),
        177:('big_treble',1),
        178:('treble',18),
        179:('treble',19),
        180:('treble',20),
        181:('treble',20),
        182:('treble',18),
        183:('treble',19),
        184:('treble',20),
        185:('treble',18),
        186:('treble',19),
        187:('treble',17),
        188:('treble',18),
        189:('treble',19),
        190:('treble',20),
        191:('treble',19),
        192:('treble',20),
        193:('treble',20),
        194:('treble',19),
        195:('treble',19),
        196:('treble',20),
        197:('treble',20),
        198:('treble',20),
        199:('treble',20),
        200:('treble',20),
        201:('treble',20),
        202:('treble',20),
        203:('treble',19),
        204:('treble',20),
        205:('treble',20),
        206:('treble',20),
        207:('treble',19),
        208:('treble',20),
        209:('treble',20),
        210:('treble',20),
        211:('treble',19),
        212:('treble',20),
        213:('treble',20), 
        214:('treble',20),
        215:('treble',20),
        216:('treble',20),
        217:('treble',20),
        218:('treble',19),
        219:('treble',20),
        220:('treble',20),
        221:('treble',20),
        222:('treble',20),#
        223:('treble',20),#
        224:('treble',18),
        225:('treble',20),#
        226:('treble',20),#
        227:('treble',19),
        228:('treble',20),
        229:('treble',20),
        230:('treble',20),
        231:('treble',20),
        232:('treble',20),
        233:('treble',20),
        234:('treble',20),
        235:('treble',20),
        236:('treble',20),
        237:('treble',20),
        238:('treble',20),
        239:('treble',20),
        240:('treble',20),
        241:('treble',20),
        242:('treble',20),
        243:('treble',19),
        244:('treble',20),
        245:('treble',20),
        246:('treble',20),
        247:('treble',19),
        248:('treble',20),
        249:('treble',20),
        250:('treble',20),
        251:('treble',19),
        252:('treble',20),
        253:('treble',20),
        254:('treble',20),
        255:('treble',20),
        256:('treble',20),
        257:('treble',20),
        258:('treble',20),
        259:('treble',19),
        260:('treble',20),
        261:('treble',20),
        262:('treble',19),
        263:('treble',20),
        264:('treble',20),
        265:('treble',19)
        }
  
    def reset(self):
        self.score = 501
    
    def treble(self,n):
        r = np.random.random()
        n1 = self.neighbours[n][0]
        n2 = self.neighbours[n][1]
        if r<=self.t:
            return 3*n
        elif (self.t < r) and (r <=self.s):
            return n
        elif (self.s < r) and (r <= self.bm):
            return np.random.choice([3*n1,3*n2])
        elif (self.bm < r) and (r <= self.sm):
            return np.random.choice([n1,n2])
        else:
            return 0     
        
    def big_treble(self):
        switch = np.random.random()
        if switch<=0.15:
            N = 19
        else:
            N = 20    
        return self.treble(n=N)
        
    def double(self,n):
        r = np.random.random()
        n1 = self.neighbours[n][0]
        n2 = self.neighbours[n][1]
        if r<=self.d:
            return 2*n
        elif r>0.97:
            return np.random.choice([2*n1,2*n2])
        else:
            return np.random.choice([0,0,0,n,n])

    def single(self,n):
        r = np.random.random()
        n1 = self.neighbours[n][0]
        n2 = self.neighbours[n][1]
        if r<=0.98:
            return n
        else:
            return np.random.choice([n1,n2])
      
    def bull(self):
        r = np.random.random()
        if r<=self.bull_pct:
            return 50
        else: 
            return np.random.choice(self.neighbours[50])
    
    def outer(self):
        r = np.random.random()
        if r<=self.outer_pct:
            return 25
        else: 
            return np.random.choice(self.neighbours[25])
    
    def dict_to_dart(self,section,value):
        if section == 'treble':
            return self.treble(value)
        elif section == 'big_treble':
            return self.big_treble()
        elif section == 'double':
            return self.double(value)
        elif section == 'single':
            return self.single(value)
        elif section == 'outer':
            return self.outer()
        elif section == 'bull':
            return self.bull()
        else:
            print('Key error')
        
    def throw(self):
        
        if self.score == 303:
            tot = self.treble(19)+self.treble(19)+self.treble(19)
        
        elif self.score > 265:
            tot = self.treble(20)+self.big_treble()+self.big_treble()
        
        else:
        
            target = self.score
            s1,v1 = self.THREE[target]
            d1 = self.dict_to_dart(s1,v1)
            #print('d1',target,d1)
            
            if target - d1 == 0:
                tot = d1
                
            elif target - d1 <=1:
                tot = 0
                
            else:
                new_target = target - d1
                s2,v2 = self.TWO[new_target]
                d2 = self.dict_to_dart(s2,v2)
                #print('d2',new_target,d2)
                
                if new_target - d2 == 0:
                    tot = d1+d2
                elif new_target - d2 <=1:
                    tot = 0
                else:
                    final_target = new_target - d2
                    s3,v3 = self.ONE[final_target]
                    d3 = self.dict_to_dart(s3,v3)
                    #print('d3',final_target,d3)
                    
                    if final_target - d3 == 0:
                        tot = d1+d2+d3 
                    elif final_target - d3 <= 1 :
                        tot = 0
                    else:
                        tot = d1+d2+d3
                    
        self.score -= tot
    
